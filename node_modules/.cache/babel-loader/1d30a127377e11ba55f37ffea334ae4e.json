{"ast":null,"code":"/**\n * Npm version of markerClusterer works great with browserify and google maps for commonjs\n * https://www.npmjs.com/package/googlemaps\n * Difference from the original - adds a commonjs format and replaces window with global and some unit test\n * The original functionality it's not modified for docs and original source check\n * https://github.com/googlemaps/js-marker-clusterer\n */\n\n/**\n * @name MarkerClusterer for Google Maps v3\n * @version version 1.0\n * @author Luke Mahe\n * @fileoverview\n * The library creates and manages per-zoom-level clusters for large amounts of\n * markers.\n * <br/>\n * This is a v3 implementation of the\n * <a href=\"http://gmaps-utility-library-dev.googlecode.com/svn/tags/markerclusterer/\"\n * >v2 MarkerClusterer</a>.\n */\n\n/**\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * A Marker Clusterer that clusters markers.\n *\n * @param {google.maps.Map} map The Google map to attach to.\n * @param {Array.<google.maps.Marker>=} opt_markers Optional markers to add to\n *   the cluster.\n * @param {Object=} opt_options support the following options:\n *     'gridSize': (number) The grid size of a cluster in pixels.\n *     'maxZoom': (number) The maximum zoom level that a marker can be part of a\n *                cluster.\n *     'zoomOnClick': (boolean) Whether the default behaviour of clicking on a\n *                    cluster is to zoom into it.\n *     'averageCenter': (boolean) Wether the center of each cluster should be\n *                      the average of all markers in the cluster.\n *     'minimumClusterSize': (number) The minimum number of markers to be in a\n *                           cluster before the markers are hidden and a count\n *                           is shown.\n *     'styles': (object) An object that has style properties:\n *       'url': (string) The image url.\n *       'height': (number) The image height.\n *       'width': (number) The image width.\n *       'anchor': (Array) The anchor position of the label text.\n *       'textColor': (string) The text color.\n *       'textSize': (number) The text size.\n *       'backgroundPosition': (string) The position of the backgound x, y.\n * @constructor\n * @extends google.maps.OverlayView\n */\nfunction MarkerClusterer(map, opt_markers, opt_options) {\n  // MarkerClusterer implements google.maps.OverlayView interface. We use the\n  // extend function to extend MarkerClusterer with google.maps.OverlayView\n  // because it might not always be available when the code is defined so we\n  // look for it at the last possible moment. If it doesn't exist now then\n  // there is no point going ahead :)\n  this.extend(MarkerClusterer, google.maps.OverlayView);\n  this.map_ = map;\n  /**\n   * @type {Array.<google.maps.Marker>}\n   * @private\n   */\n\n  this.markers_ = [];\n  /**\n   *  @type {Array.<Cluster>}\n   */\n\n  this.clusters_ = [];\n  this.sizes = [53, 56, 66, 78, 90];\n  /**\n   * @private\n   */\n\n  this.styles_ = [];\n  /**\n   * @type {boolean}\n   * @private\n   */\n\n  this.ready_ = false;\n  var options = opt_options || {};\n  /**\n   * @type {number}\n   * @private\n   */\n\n  this.gridSize_ = options['gridSize'] || 60;\n  /**\n   * @private\n   */\n\n  this.minClusterSize_ = options['minimumClusterSize'] || 2;\n  /**\n   * @type {?number}\n   * @private\n   */\n\n  this.maxZoom_ = options['maxZoom'] || null;\n  this.styles_ = options['styles'] || [];\n  /**\n   * @type {string}\n   * @private\n   */\n\n  this.imagePath_ = options['imagePath'] || this.MARKER_CLUSTER_IMAGE_PATH_;\n  /**\n   * @type {string}\n   * @private\n   */\n\n  this.imageExtension_ = options['imageExtension'] || this.MARKER_CLUSTER_IMAGE_EXTENSION_;\n  /**\n   * @type {boolean}\n   * @private\n   */\n\n  this.zoomOnClick_ = true;\n\n  if (options['zoomOnClick'] != undefined) {\n    this.zoomOnClick_ = options['zoomOnClick'];\n  }\n  /**\n   * @type {boolean}\n   * @private\n   */\n\n\n  this.averageCenter_ = false;\n\n  if (options['averageCenter'] != undefined) {\n    this.averageCenter_ = options['averageCenter'];\n  }\n\n  this.setupStyles_();\n  this.setMap(map);\n  /**\n   * @type {number}\n   * @private\n   */\n\n  this.prevZoom_ = this.map_.getZoom(); // Add the map event listeners\n\n  var that = this;\n  google.maps.event.addListener(this.map_, 'zoom_changed', function () {\n    var zoom = that.map_.getZoom();\n\n    if (that.prevZoom_ != zoom) {\n      that.prevZoom_ = zoom;\n      that.resetViewport();\n    }\n  });\n  google.maps.event.addListener(this.map_, 'idle', function () {\n    that.redraw();\n  }); // Finally, add the markers\n\n  if (opt_markers && opt_markers.length) {\n    this.addMarkers(opt_markers, false);\n  }\n}\n/**\n * The marker cluster image path.\n *\n * @type {string}\n * @private\n */\n\n\nMarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_PATH_ = 'http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/' + 'images/m';\n/**\n * The marker cluster image path.\n *\n * @type {string}\n * @private\n */\n\nMarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_EXTENSION_ = 'png';\n/**\n * Extends a objects prototype by anothers.\n *\n * @param {Object} obj1 The object to be extended.\n * @param {Object} obj2 The object to extend with.\n * @return {Object} The new extended object.\n * @ignore\n */\n\nMarkerClusterer.prototype.extend = function (obj1, obj2) {\n  return function (object) {\n    for (var property in object.prototype) {\n      this.prototype[property] = object.prototype[property];\n    }\n\n    return this;\n  }.apply(obj1, [obj2]);\n};\n/**\n * Implementaion of the interface method.\n * @ignore\n */\n\n\nMarkerClusterer.prototype.onAdd = function () {\n  this.setReady_(true);\n};\n/**\n * Implementaion of the interface method.\n * @ignore\n */\n\n\nMarkerClusterer.prototype.draw = function () {};\n/**\n * Sets up the styles object.\n *\n * @private\n */\n\n\nMarkerClusterer.prototype.setupStyles_ = function () {\n  if (this.styles_.length) {\n    return;\n  }\n\n  for (var i = 0, size; size = this.sizes[i]; i++) {\n    this.styles_.push({\n      url: this.imagePath_ + (i + 1) + '.' + this.imageExtension_,\n      height: size,\n      width: size\n    });\n  }\n};\n/**\n *  Fit the map to the bounds of the markers in the clusterer.\n */\n\n\nMarkerClusterer.prototype.fitMapToMarkers = function () {\n  var markers = this.getMarkers();\n  var bounds = new google.maps.LatLngBounds();\n\n  for (var i = 0, marker; marker = markers[i]; i++) {\n    bounds.extend(marker.getPosition());\n  }\n\n  this.map_.fitBounds(bounds);\n};\n/**\n *  Sets the styles.\n *\n *  @param {Object} styles The style to set.\n */\n\n\nMarkerClusterer.prototype.setStyles = function (styles) {\n  this.styles_ = styles;\n};\n/**\n *  Gets the styles.\n *\n *  @return {Object} The styles object.\n */\n\n\nMarkerClusterer.prototype.getStyles = function () {\n  return this.styles_;\n};\n/**\n * Whether zoom on click is set.\n *\n * @return {boolean} True if zoomOnClick_ is set.\n */\n\n\nMarkerClusterer.prototype.isZoomOnClick = function () {\n  return this.zoomOnClick_;\n};\n/**\n * Whether average center is set.\n *\n * @return {boolean} True if averageCenter_ is set.\n */\n\n\nMarkerClusterer.prototype.isAverageCenter = function () {\n  return this.averageCenter_;\n};\n/**\n *  Returns the array of markers in the clusterer.\n *\n *  @return {Array.<google.maps.Marker>} The markers.\n */\n\n\nMarkerClusterer.prototype.getMarkers = function () {\n  return this.markers_;\n};\n/**\n *  Returns the number of markers in the clusterer\n *\n *  @return {Number} The number of markers.\n */\n\n\nMarkerClusterer.prototype.getTotalMarkers = function () {\n  return this.markers_.length;\n};\n/**\n *  Sets the max zoom for the clusterer.\n *\n *  @param {number} maxZoom The max zoom level.\n */\n\n\nMarkerClusterer.prototype.setMaxZoom = function (maxZoom) {\n  this.maxZoom_ = maxZoom;\n};\n/**\n *  Gets the max zoom for the clusterer.\n *\n *  @return {number} The max zoom level.\n */\n\n\nMarkerClusterer.prototype.getMaxZoom = function () {\n  return this.maxZoom_;\n};\n/**\n *  The function for calculating the cluster icon image.\n *\n *  @param {Array.<google.maps.Marker>} markers The markers in the clusterer.\n *  @param {number} numStyles The number of styles available.\n *  @return {Object} A object properties: 'text' (string) and 'index' (number).\n *  @private\n */\n\n\nMarkerClusterer.prototype.calculator_ = function (markers, numStyles) {\n  var index = 0;\n  var count = markers.length;\n  var dv = count;\n\n  while (dv !== 0) {\n    dv = parseInt(dv / 10, 10);\n    index++;\n  }\n\n  index = Math.min(index, numStyles);\n  return {\n    text: count,\n    index: index\n  };\n};\n/**\n * Set the calculator function.\n *\n * @param {function(Array, number)} calculator The function to set as the\n *     calculator. The function should return a object properties:\n *     'text' (string) and 'index' (number).\n *\n */\n\n\nMarkerClusterer.prototype.setCalculator = function (calculator) {\n  this.calculator_ = calculator;\n};\n/**\n * Get the calculator function.\n *\n * @return {function(Array, number)} the calculator function.\n */\n\n\nMarkerClusterer.prototype.getCalculator = function () {\n  return this.calculator_;\n};\n/**\n * Add an array of markers to the clusterer.\n *\n * @param {Array.<google.maps.Marker>} markers The markers to add.\n * @param {boolean=} opt_nodraw Whether to redraw the clusters.\n */\n\n\nMarkerClusterer.prototype.addMarkers = function (markers, opt_nodraw) {\n  for (var i = 0, marker; marker = markers[i]; i++) {\n    this.pushMarkerTo_(marker);\n  }\n\n  if (!opt_nodraw) {\n    this.redraw();\n  }\n};\n/**\n * Pushes a marker to the clusterer.\n *\n * @param {google.maps.Marker} marker The marker to add.\n * @private\n */\n\n\nMarkerClusterer.prototype.pushMarkerTo_ = function (marker) {\n  marker.isAdded = false;\n\n  if (marker['draggable']) {\n    // If the marker is draggable add a listener so we update the clusters on\n    // the drag end.\n    var that = this;\n    google.maps.event.addListener(marker, 'dragend', function () {\n      marker.isAdded = false;\n      that.repaint();\n    });\n  }\n\n  this.markers_.push(marker);\n};\n/**\n * Adds a marker to the clusterer and redraws if needed.\n *\n * @param {google.maps.Marker} marker The marker to add.\n * @param {boolean=} opt_nodraw Whether to redraw the clusters.\n */\n\n\nMarkerClusterer.prototype.addMarker = function (marker, opt_nodraw) {\n  this.pushMarkerTo_(marker);\n\n  if (!opt_nodraw) {\n    this.redraw();\n  }\n};\n/**\n * Removes a marker and returns true if removed, false if not\n *\n * @param {google.maps.Marker} marker The marker to remove\n * @return {boolean} Whether the marker was removed or not\n * @private\n */\n\n\nMarkerClusterer.prototype.removeMarker_ = function (marker) {\n  var index = -1;\n\n  if (this.markers_.indexOf) {\n    index = this.markers_.indexOf(marker);\n  } else {\n    for (var i = 0, m; m = this.markers_[i]; i++) {\n      if (m == marker) {\n        index = i;\n        break;\n      }\n    }\n  }\n\n  if (index == -1) {\n    // Marker is not in our list of markers.\n    return false;\n  }\n\n  marker.setMap(null);\n  this.markers_.splice(index, 1);\n  return true;\n};\n/**\n * Remove a marker from the cluster.\n *\n * @param {google.maps.Marker} marker The marker to remove.\n * @param {boolean=} opt_nodraw Optional boolean to force no redraw.\n * @return {boolean} True if the marker was removed.\n */\n\n\nMarkerClusterer.prototype.removeMarker = function (marker, opt_nodraw) {\n  var removed = this.removeMarker_(marker);\n\n  if (!opt_nodraw && removed) {\n    this.resetViewport();\n    this.redraw();\n    return true;\n  } else {\n    return false;\n  }\n};\n/**\n * Removes an array of markers from the cluster.\n *\n * @param {Array.<google.maps.Marker>} markers The markers to remove.\n * @param {boolean=} opt_nodraw Optional boolean to force no redraw.\n */\n\n\nMarkerClusterer.prototype.removeMarkers = function (markers, opt_nodraw) {\n  var removed = false;\n\n  for (var i = 0, marker; marker = markers[i]; i++) {\n    var r = this.removeMarker_(marker);\n    removed = removed || r;\n  }\n\n  if (!opt_nodraw && removed) {\n    this.resetViewport();\n    this.redraw();\n    return true;\n  }\n};\n/**\n * Sets the clusterer's ready state.\n *\n * @param {boolean} ready The state.\n * @private\n */\n\n\nMarkerClusterer.prototype.setReady_ = function (ready) {\n  if (!this.ready_) {\n    this.ready_ = ready;\n    this.createClusters_();\n  }\n};\n/**\n * Returns the number of clusters in the clusterer.\n *\n * @return {number} The number of clusters.\n */\n\n\nMarkerClusterer.prototype.getTotalClusters = function () {\n  return this.clusters_.length;\n};\n/**\n * Returns the google map that the clusterer is associated with.\n *\n * @return {google.maps.Map} The map.\n */\n\n\nMarkerClusterer.prototype.getMap = function () {\n  return this.map_;\n};\n/**\n * Sets the google map that the clusterer is associated with.\n *\n * @param {google.maps.Map} map The map.\n */\n\n\nMarkerClusterer.prototype.setMap = function (map) {\n  this.map_ = map;\n};\n/**\n * Returns the size of the grid.\n *\n * @return {number} The grid size.\n */\n\n\nMarkerClusterer.prototype.getGridSize = function () {\n  return this.gridSize_;\n};\n/**\n * Sets the size of the grid.\n *\n * @param {number} size The grid size.\n */\n\n\nMarkerClusterer.prototype.setGridSize = function (size) {\n  this.gridSize_ = size;\n};\n/**\n * Returns the min cluster size.\n *\n * @return {number} The grid size.\n */\n\n\nMarkerClusterer.prototype.getMinClusterSize = function () {\n  return this.minClusterSize_;\n};\n/**\n * Sets the min cluster size.\n *\n * @param {number} size The grid size.\n */\n\n\nMarkerClusterer.prototype.setMinClusterSize = function (size) {\n  this.minClusterSize_ = size;\n};\n/**\n * Extends a bounds object by the grid size.\n *\n * @param {google.maps.LatLngBounds} bounds The bounds to extend.\n * @return {google.maps.LatLngBounds} The extended bounds.\n */\n\n\nMarkerClusterer.prototype.getExtendedBounds = function (bounds) {\n  var projection = this.getProjection(); // Turn the bounds into latlng.\n\n  var tr = new google.maps.LatLng(bounds.getNorthEast().lat(), bounds.getNorthEast().lng());\n  var bl = new google.maps.LatLng(bounds.getSouthWest().lat(), bounds.getSouthWest().lng()); // Convert the points to pixels and the extend out by the grid size.\n\n  var trPix = projection.fromLatLngToDivPixel(tr);\n  trPix.x += this.gridSize_;\n  trPix.y -= this.gridSize_;\n  var blPix = projection.fromLatLngToDivPixel(bl);\n  blPix.x -= this.gridSize_;\n  blPix.y += this.gridSize_; // Convert the pixel points back to LatLng\n\n  var ne = projection.fromDivPixelToLatLng(trPix);\n  var sw = projection.fromDivPixelToLatLng(blPix); // Extend the bounds to contain the new bounds.\n\n  bounds.extend(ne);\n  bounds.extend(sw);\n  return bounds;\n};\n/**\n * Determins if a marker is contained in a bounds.\n *\n * @param {google.maps.Marker} marker The marker to check.\n * @param {google.maps.LatLngBounds} bounds The bounds to check against.\n * @return {boolean} True if the marker is in the bounds.\n * @private\n */\n\n\nMarkerClusterer.prototype.isMarkerInBounds_ = function (marker, bounds) {\n  return bounds.contains(marker.getPosition());\n};\n/**\n * Clears all clusters and markers from the clusterer.\n */\n\n\nMarkerClusterer.prototype.clearMarkers = function () {\n  this.resetViewport(true); // Set the markers a empty array.\n\n  this.markers_ = [];\n};\n/**\n * Clears all existing clusters and recreates them.\n * @param {boolean} opt_hide To also hide the marker.\n */\n\n\nMarkerClusterer.prototype.resetViewport = function (opt_hide) {\n  // Remove all the clusters\n  for (var i = 0, cluster; cluster = this.clusters_[i]; i++) {\n    cluster.remove();\n  } // Reset the markers to not be added and to be invisible.\n\n\n  for (var i = 0, marker; marker = this.markers_[i]; i++) {\n    marker.isAdded = false;\n\n    if (opt_hide) {\n      marker.setMap(null);\n    }\n  }\n\n  this.clusters_ = [];\n};\n/**\n *\n */\n\n\nMarkerClusterer.prototype.repaint = function () {\n  var oldClusters = this.clusters_.slice();\n  this.clusters_.length = 0;\n  this.resetViewport();\n  this.redraw(); // Remove the old clusters.\n  // Do it in a timeout so the other clusters have been drawn first.\n\n  window.setTimeout(function () {\n    for (var i = 0, cluster; cluster = oldClusters[i]; i++) {\n      cluster.remove();\n    }\n  }, 0);\n};\n/**\n * Redraws the clusters.\n */\n\n\nMarkerClusterer.prototype.redraw = function () {\n  this.createClusters_();\n};\n/**\n * Calculates the distance between two latlng locations in km.\n * @see http://www.movable-type.co.uk/scripts/latlong.html\n *\n * @param {google.maps.LatLng} p1 The first lat lng point.\n * @param {google.maps.LatLng} p2 The second lat lng point.\n * @return {number} The distance between the two points in km.\n * @private\n*/\n\n\nMarkerClusterer.prototype.distanceBetweenPoints_ = function (p1, p2) {\n  if (!p1 || !p2) {\n    return 0;\n  }\n\n  var R = 6371; // Radius of the Earth in km\n\n  var dLat = (p2.lat() - p1.lat()) * Math.PI / 180;\n  var dLon = (p2.lng() - p1.lng()) * Math.PI / 180;\n  var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(p1.lat() * Math.PI / 180) * Math.cos(p2.lat() * Math.PI / 180) * Math.sin(dLon / 2) * Math.sin(dLon / 2);\n  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  var d = R * c;\n  return d;\n};\n/**\n * Add a marker to a cluster, or creates a new cluster.\n *\n * @param {google.maps.Marker} marker The marker to add.\n * @private\n */\n\n\nMarkerClusterer.prototype.addToClosestCluster_ = function (marker) {\n  var distance = 40000; // Some large number\n\n  var clusterToAddTo = null;\n  var pos = marker.getPosition();\n\n  for (var i = 0, cluster; cluster = this.clusters_[i]; i++) {\n    var center = cluster.getCenter();\n\n    if (center) {\n      var d = this.distanceBetweenPoints_(center, marker.getPosition());\n\n      if (d < distance) {\n        distance = d;\n        clusterToAddTo = cluster;\n      }\n    }\n  }\n\n  if (clusterToAddTo && clusterToAddTo.isMarkerInClusterBounds(marker)) {\n    clusterToAddTo.addMarker(marker);\n  } else {\n    var cluster = new Cluster(this);\n    cluster.addMarker(marker);\n    this.clusters_.push(cluster);\n  }\n};\n/**\n * Creates the clusters.\n *\n * @private\n */\n\n\nMarkerClusterer.prototype.createClusters_ = function () {\n  if (!this.ready_) {\n    return;\n  } // Get our current map view bounds.\n  // Create a new bounds object so we don't affect the map.\n\n\n  var mapBounds = new google.maps.LatLngBounds(this.map_.getBounds().getSouthWest(), this.map_.getBounds().getNorthEast());\n  var bounds = this.getExtendedBounds(mapBounds);\n\n  for (var i = 0, marker; marker = this.markers_[i]; i++) {\n    if (!marker.isAdded && this.isMarkerInBounds_(marker, bounds)) {\n      this.addToClosestCluster_(marker);\n    }\n  }\n};\n/**\n * A cluster that contains markers.\n *\n * @param {MarkerClusterer} markerClusterer The markerclusterer that this\n *     cluster is associated with.\n * @constructor\n * @ignore\n */\n\n\nfunction Cluster(markerClusterer) {\n  this.markerClusterer_ = markerClusterer;\n  this.map_ = markerClusterer.getMap();\n  this.gridSize_ = markerClusterer.getGridSize();\n  this.minClusterSize_ = markerClusterer.getMinClusterSize();\n  this.averageCenter_ = markerClusterer.isAverageCenter();\n  this.center_ = null;\n  this.markers_ = [];\n  this.bounds_ = null;\n  this.clusterIcon_ = new ClusterIcon(this, markerClusterer.getStyles(), markerClusterer.getGridSize());\n}\n/**\n * Determins if a marker is already added to the cluster.\n *\n * @param {google.maps.Marker} marker The marker to check.\n * @return {boolean} True if the marker is already added.\n */\n\n\nCluster.prototype.isMarkerAlreadyAdded = function (marker) {\n  if (this.markers_.indexOf) {\n    return this.markers_.indexOf(marker) != -1;\n  } else {\n    for (var i = 0, m; m = this.markers_[i]; i++) {\n      if (m == marker) {\n        return true;\n      }\n    }\n  }\n\n  return false;\n};\n/**\n * Add a marker the cluster.\n *\n * @param {google.maps.Marker} marker The marker to add.\n * @return {boolean} True if the marker was added.\n */\n\n\nCluster.prototype.addMarker = function (marker) {\n  if (this.isMarkerAlreadyAdded(marker)) {\n    return false;\n  }\n\n  if (!this.center_) {\n    this.center_ = marker.getPosition();\n    this.calculateBounds_();\n  } else {\n    if (this.averageCenter_) {\n      var l = this.markers_.length + 1;\n      var lat = (this.center_.lat() * (l - 1) + marker.getPosition().lat()) / l;\n      var lng = (this.center_.lng() * (l - 1) + marker.getPosition().lng()) / l;\n      this.center_ = new google.maps.LatLng(lat, lng);\n      this.calculateBounds_();\n    }\n  }\n\n  marker.isAdded = true;\n  this.markers_.push(marker);\n  var len = this.markers_.length;\n\n  if (len < this.minClusterSize_ && marker.getMap() != this.map_) {\n    // Min cluster size not reached so show the marker.\n    marker.setMap(this.map_);\n  }\n\n  if (len == this.minClusterSize_) {\n    // Hide the markers that were showing.\n    for (var i = 0; i < len; i++) {\n      this.markers_[i].setMap(null);\n    }\n  }\n\n  if (len >= this.minClusterSize_) {\n    marker.setMap(null);\n  }\n\n  this.updateIcon();\n  return true;\n};\n/**\n * Returns the marker clusterer that the cluster is associated with.\n *\n * @return {MarkerClusterer} The associated marker clusterer.\n */\n\n\nCluster.prototype.getMarkerClusterer = function () {\n  return this.markerClusterer_;\n};\n/**\n * Returns the bounds of the cluster.\n *\n * @return {google.maps.LatLngBounds} the cluster bounds.\n */\n\n\nCluster.prototype.getBounds = function () {\n  var bounds = new google.maps.LatLngBounds(this.center_, this.center_);\n  var markers = this.getMarkers();\n\n  for (var i = 0, marker; marker = markers[i]; i++) {\n    bounds.extend(marker.getPosition());\n  }\n\n  return bounds;\n};\n/**\n * Removes the cluster\n */\n\n\nCluster.prototype.remove = function () {\n  this.clusterIcon_.remove();\n  this.markers_.length = 0;\n  delete this.markers_;\n};\n/**\n * Returns the center of the cluster.\n *\n * @return {number} The cluster center.\n */\n\n\nCluster.prototype.getSize = function () {\n  return this.markers_.length;\n};\n/**\n * Returns the center of the cluster.\n *\n * @return {Array.<google.maps.Marker>} The cluster center.\n */\n\n\nCluster.prototype.getMarkers = function () {\n  return this.markers_;\n};\n/**\n * Returns the center of the cluster.\n *\n * @return {google.maps.LatLng} The cluster center.\n */\n\n\nCluster.prototype.getCenter = function () {\n  return this.center_;\n};\n/**\n * Calculated the extended bounds of the cluster with the grid.\n *\n * @private\n */\n\n\nCluster.prototype.calculateBounds_ = function () {\n  var bounds = new google.maps.LatLngBounds(this.center_, this.center_);\n  this.bounds_ = this.markerClusterer_.getExtendedBounds(bounds);\n};\n/**\n * Determines if a marker lies in the clusters bounds.\n *\n * @param {google.maps.Marker} marker The marker to check.\n * @return {boolean} True if the marker lies in the bounds.\n */\n\n\nCluster.prototype.isMarkerInClusterBounds = function (marker) {\n  return this.bounds_.contains(marker.getPosition());\n};\n/**\n * Returns the map that the cluster is associated with.\n *\n * @return {google.maps.Map} The map.\n */\n\n\nCluster.prototype.getMap = function () {\n  return this.map_;\n};\n/**\n * Updates the cluster icon\n */\n\n\nCluster.prototype.updateIcon = function () {\n  var zoom = this.map_.getZoom();\n  var mz = this.markerClusterer_.getMaxZoom();\n\n  if (mz && zoom > mz) {\n    // The zoom is greater than our max zoom so show all the markers in cluster.\n    for (var i = 0, marker; marker = this.markers_[i]; i++) {\n      marker.setMap(this.map_);\n    }\n\n    return;\n  }\n\n  if (this.markers_.length < this.minClusterSize_) {\n    // Min cluster size not yet reached.\n    this.clusterIcon_.hide();\n    return;\n  }\n\n  var numStyles = this.markerClusterer_.getStyles().length;\n  var sums = this.markerClusterer_.getCalculator()(this.markers_, numStyles);\n  this.clusterIcon_.setCenter(this.center_);\n  this.clusterIcon_.setSums(sums);\n  this.clusterIcon_.show();\n};\n/**\n * A cluster icon\n *\n * @param {Cluster} cluster The cluster to be associated with.\n * @param {Object} styles An object that has style properties:\n *     'url': (string) The image url.\n *     'height': (number) The image height.\n *     'width': (number) The image width.\n *     'anchor': (Array) The anchor position of the label text.\n *     'textColor': (string) The text color.\n *     'textSize': (number) The text size.\n *     'backgroundPosition: (string) The background postition x, y.\n * @param {number=} opt_padding Optional padding to apply to the cluster icon.\n * @constructor\n * @extends google.maps.OverlayView\n * @ignore\n */\n\n\nfunction ClusterIcon(cluster, styles, opt_padding) {\n  cluster.getMarkerClusterer().extend(ClusterIcon, google.maps.OverlayView);\n  this.styles_ = styles;\n  this.padding_ = opt_padding || 0;\n  this.cluster_ = cluster;\n  this.center_ = null;\n  this.map_ = cluster.getMap();\n  this.div_ = null;\n  this.sums_ = null;\n  this.visible_ = false;\n  this.setMap(this.map_);\n}\n/**\n * Triggers the clusterclick event and zoom's if the option is set.\n */\n\n\nClusterIcon.prototype.triggerClusterClick = function () {\n  var markerClusterer = this.cluster_.getMarkerClusterer(); // Trigger the clusterclick event.\n\n  google.maps.event.trigger(markerClusterer, 'clusterclick', this.cluster_);\n\n  if (markerClusterer.isZoomOnClick()) {\n    // Zoom into the cluster.\n    this.map_.fitBounds(this.cluster_.getBounds());\n  }\n};\n/**\n * Adding the cluster icon to the dom.\n * @ignore\n */\n\n\nClusterIcon.prototype.onAdd = function () {\n  this.div_ = document.createElement('DIV');\n\n  if (this.visible_) {\n    var pos = this.getPosFromLatLng_(this.center_);\n    this.div_.style.cssText = this.createCss(pos);\n    this.div_.innerHTML = this.sums_.text;\n  }\n\n  var panes = this.getPanes();\n  panes.overlayMouseTarget.appendChild(this.div_);\n  var that = this;\n  google.maps.event.addDomListener(this.div_, 'click', function () {\n    that.triggerClusterClick();\n  });\n};\n/**\n * Returns the position to place the div dending on the latlng.\n *\n * @param {google.maps.LatLng} latlng The position in latlng.\n * @return {google.maps.Point} The position in pixels.\n * @private\n */\n\n\nClusterIcon.prototype.getPosFromLatLng_ = function (latlng) {\n  var pos = this.getProjection().fromLatLngToDivPixel(latlng);\n  pos.x -= parseInt(this.width_ / 2, 10);\n  pos.y -= parseInt(this.height_ / 2, 10);\n  return pos;\n};\n/**\n * Draw the icon.\n * @ignore\n */\n\n\nClusterIcon.prototype.draw = function () {\n  if (this.visible_) {\n    var pos = this.getPosFromLatLng_(this.center_);\n    this.div_.style.top = pos.y + 'px';\n    this.div_.style.left = pos.x + 'px';\n  }\n};\n/**\n * Hide the icon.\n */\n\n\nClusterIcon.prototype.hide = function () {\n  if (this.div_) {\n    this.div_.style.display = 'none';\n  }\n\n  this.visible_ = false;\n};\n/**\n * Position and show the icon.\n */\n\n\nClusterIcon.prototype.show = function () {\n  if (this.div_) {\n    var pos = this.getPosFromLatLng_(this.center_);\n    this.div_.style.cssText = this.createCss(pos);\n    this.div_.style.display = '';\n  }\n\n  this.visible_ = true;\n};\n/**\n * Remove the icon from the map\n */\n\n\nClusterIcon.prototype.remove = function () {\n  this.setMap(null);\n};\n/**\n * Implementation of the onRemove interface.\n * @ignore\n */\n\n\nClusterIcon.prototype.onRemove = function () {\n  if (this.div_ && this.div_.parentNode) {\n    this.hide();\n    this.div_.parentNode.removeChild(this.div_);\n    this.div_ = null;\n  }\n};\n/**\n * Set the sums of the icon.\n *\n * @param {Object} sums The sums containing:\n *   'text': (string) The text to display in the icon.\n *   'index': (number) The style index of the icon.\n */\n\n\nClusterIcon.prototype.setSums = function (sums) {\n  this.sums_ = sums;\n  this.text_ = sums.text;\n  this.index_ = sums.index;\n\n  if (this.div_) {\n    this.div_.innerHTML = sums.text;\n  }\n\n  this.useStyle();\n};\n/**\n * Sets the icon to the the styles.\n */\n\n\nClusterIcon.prototype.useStyle = function () {\n  var index = Math.max(0, this.sums_.index - 1);\n  index = Math.min(this.styles_.length - 1, index);\n  var style = this.styles_[index];\n  this.url_ = style['url'];\n  this.height_ = style['height'];\n  this.width_ = style['width'];\n  this.textColor_ = style['textColor'];\n  this.anchor_ = style['anchor'];\n  this.textSize_ = style['textSize'];\n  this.backgroundPosition_ = style['backgroundPosition'];\n};\n/**\n * Sets the center of the icon.\n *\n * @param {google.maps.LatLng} center The latlng to set as the center.\n */\n\n\nClusterIcon.prototype.setCenter = function (center) {\n  this.center_ = center;\n};\n/**\n * Create the css text based on the position of the icon.\n *\n * @param {google.maps.Point} pos The position.\n * @return {string} The css style text.\n */\n\n\nClusterIcon.prototype.createCss = function (pos) {\n  var style = [];\n  style.push('background-image:url(' + this.url_ + ');');\n  var backgroundPosition = this.backgroundPosition_ ? this.backgroundPosition_ : '0 0';\n  style.push('background-position:' + backgroundPosition + ';');\n\n  if (typeof this.anchor_ === 'object') {\n    if (typeof this.anchor_[0] === 'number' && this.anchor_[0] > 0 && this.anchor_[0] < this.height_) {\n      style.push('height:' + (this.height_ - this.anchor_[0]) + 'px; padding-top:' + this.anchor_[0] + 'px;');\n    } else {\n      style.push('height:' + this.height_ + 'px; line-height:' + this.height_ + 'px;');\n    }\n\n    if (typeof this.anchor_[1] === 'number' && this.anchor_[1] > 0 && this.anchor_[1] < this.width_) {\n      style.push('width:' + (this.width_ - this.anchor_[1]) + 'px; padding-left:' + this.anchor_[1] + 'px;');\n    } else {\n      style.push('width:' + this.width_ + 'px; text-align:center;');\n    }\n  } else {\n    style.push('height:' + this.height_ + 'px; line-height:' + this.height_ + 'px; width:' + this.width_ + 'px; text-align:center;');\n  }\n\n  var txtColor = this.textColor_ ? this.textColor_ : 'black';\n  var txtSize = this.textSize_ ? this.textSize_ : 11;\n  style.push('cursor:pointer; top:' + pos.y + 'px; left:' + pos.x + 'px; color:' + txtColor + '; position:absolute; font-size:' + txtSize + 'px; font-family:Arial,sans-serif; font-weight:bold');\n  return style.join('');\n}; // Export Symbols for Closure\n// If you are not going to compile with closure then you can remove the\n// code below.\n\n\nglobal['MarkerClusterer'] = MarkerClusterer;\nMarkerClusterer.prototype['addMarker'] = MarkerClusterer.prototype.addMarker;\nMarkerClusterer.prototype['addMarkers'] = MarkerClusterer.prototype.addMarkers;\nMarkerClusterer.prototype['clearMarkers'] = MarkerClusterer.prototype.clearMarkers;\nMarkerClusterer.prototype['fitMapToMarkers'] = MarkerClusterer.prototype.fitMapToMarkers;\nMarkerClusterer.prototype['getCalculator'] = MarkerClusterer.prototype.getCalculator;\nMarkerClusterer.prototype['getGridSize'] = MarkerClusterer.prototype.getGridSize;\nMarkerClusterer.prototype['getExtendedBounds'] = MarkerClusterer.prototype.getExtendedBounds;\nMarkerClusterer.prototype['getMap'] = MarkerClusterer.prototype.getMap;\nMarkerClusterer.prototype['getMarkers'] = MarkerClusterer.prototype.getMarkers;\nMarkerClusterer.prototype['getMaxZoom'] = MarkerClusterer.prototype.getMaxZoom;\nMarkerClusterer.prototype['getStyles'] = MarkerClusterer.prototype.getStyles;\nMarkerClusterer.prototype['getTotalClusters'] = MarkerClusterer.prototype.getTotalClusters;\nMarkerClusterer.prototype['getTotalMarkers'] = MarkerClusterer.prototype.getTotalMarkers;\nMarkerClusterer.prototype['redraw'] = MarkerClusterer.prototype.redraw;\nMarkerClusterer.prototype['removeMarker'] = MarkerClusterer.prototype.removeMarker;\nMarkerClusterer.prototype['removeMarkers'] = MarkerClusterer.prototype.removeMarkers;\nMarkerClusterer.prototype['resetViewport'] = MarkerClusterer.prototype.resetViewport;\nMarkerClusterer.prototype['repaint'] = MarkerClusterer.prototype.repaint;\nMarkerClusterer.prototype['setCalculator'] = MarkerClusterer.prototype.setCalculator;\nMarkerClusterer.prototype['setGridSize'] = MarkerClusterer.prototype.setGridSize;\nMarkerClusterer.prototype['setMaxZoom'] = MarkerClusterer.prototype.setMaxZoom;\nMarkerClusterer.prototype['onAdd'] = MarkerClusterer.prototype.onAdd;\nMarkerClusterer.prototype['draw'] = MarkerClusterer.prototype.draw;\nCluster.prototype['getCenter'] = Cluster.prototype.getCenter;\nCluster.prototype['getSize'] = Cluster.prototype.getSize;\nCluster.prototype['getMarkers'] = Cluster.prototype.getMarkers;\nClusterIcon.prototype['onAdd'] = ClusterIcon.prototype.onAdd;\nClusterIcon.prototype['draw'] = ClusterIcon.prototype.draw;\nClusterIcon.prototype['onRemove'] = ClusterIcon.prototype.onRemove;\nmodule.exports = MarkerClusterer;","map":{"version":3,"sources":["E:/github/covid/COVID19_amid_twitter_analysing/node_modules/node-js-marker-clusterer/src/markerclusterer.js"],"names":["MarkerClusterer","map","opt_markers","opt_options","extend","google","maps","OverlayView","map_","markers_","clusters_","sizes","styles_","ready_","options","gridSize_","minClusterSize_","maxZoom_","imagePath_","MARKER_CLUSTER_IMAGE_PATH_","imageExtension_","MARKER_CLUSTER_IMAGE_EXTENSION_","zoomOnClick_","undefined","averageCenter_","setupStyles_","setMap","prevZoom_","getZoom","that","event","addListener","zoom","resetViewport","redraw","length","addMarkers","prototype","obj1","obj2","object","property","apply","onAdd","setReady_","draw","i","size","push","url","height","width","fitMapToMarkers","markers","getMarkers","bounds","LatLngBounds","marker","getPosition","fitBounds","setStyles","styles","getStyles","isZoomOnClick","isAverageCenter","getTotalMarkers","setMaxZoom","maxZoom","getMaxZoom","calculator_","numStyles","index","count","dv","parseInt","Math","min","text","setCalculator","calculator","getCalculator","opt_nodraw","pushMarkerTo_","isAdded","repaint","addMarker","removeMarker_","indexOf","m","splice","removeMarker","removed","removeMarkers","r","ready","createClusters_","getTotalClusters","getMap","getGridSize","setGridSize","getMinClusterSize","setMinClusterSize","getExtendedBounds","projection","getProjection","tr","LatLng","getNorthEast","lat","lng","bl","getSouthWest","trPix","fromLatLngToDivPixel","x","y","blPix","ne","fromDivPixelToLatLng","sw","isMarkerInBounds_","contains","clearMarkers","opt_hide","cluster","remove","oldClusters","slice","window","setTimeout","distanceBetweenPoints_","p1","p2","R","dLat","PI","dLon","a","sin","cos","c","atan2","sqrt","d","addToClosestCluster_","distance","clusterToAddTo","pos","center","getCenter","isMarkerInClusterBounds","Cluster","mapBounds","getBounds","markerClusterer","markerClusterer_","center_","bounds_","clusterIcon_","ClusterIcon","isMarkerAlreadyAdded","calculateBounds_","l","len","updateIcon","getMarkerClusterer","getSize","mz","hide","sums","setCenter","setSums","show","opt_padding","padding_","cluster_","div_","sums_","visible_","triggerClusterClick","trigger","document","createElement","getPosFromLatLng_","style","cssText","createCss","innerHTML","panes","getPanes","overlayMouseTarget","appendChild","addDomListener","latlng","width_","height_","top","left","display","onRemove","parentNode","removeChild","text_","index_","useStyle","max","url_","textColor_","anchor_","textSize_","backgroundPosition_","backgroundPosition","txtColor","txtSize","join","global","module","exports"],"mappings":"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","sourcesContent":["/**\n * Npm version of markerClusterer works great with browserify and google maps for commonjs\n * https://www.npmjs.com/package/googlemaps\n * Difference from the original - adds a commonjs format and replaces window with global and some unit test\n * The original functionality it's not modified for docs and original source check\n * https://github.com/googlemaps/js-marker-clusterer\n */\n\n/**\n * @name MarkerClusterer for Google Maps v3\n * @version version 1.0\n * @author Luke Mahe\n * @fileoverview\n * The library creates and manages per-zoom-level clusters for large amounts of\n * markers.\n * <br/>\n * This is a v3 implementation of the\n * <a href=\"http://gmaps-utility-library-dev.googlecode.com/svn/tags/markerclusterer/\"\n * >v2 MarkerClusterer</a>.\n */\n\n/**\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n/**\n * A Marker Clusterer that clusters markers.\n *\n * @param {google.maps.Map} map The Google map to attach to.\n * @param {Array.<google.maps.Marker>=} opt_markers Optional markers to add to\n *   the cluster.\n * @param {Object=} opt_options support the following options:\n *     'gridSize': (number) The grid size of a cluster in pixels.\n *     'maxZoom': (number) The maximum zoom level that a marker can be part of a\n *                cluster.\n *     'zoomOnClick': (boolean) Whether the default behaviour of clicking on a\n *                    cluster is to zoom into it.\n *     'averageCenter': (boolean) Wether the center of each cluster should be\n *                      the average of all markers in the cluster.\n *     'minimumClusterSize': (number) The minimum number of markers to be in a\n *                           cluster before the markers are hidden and a count\n *                           is shown.\n *     'styles': (object) An object that has style properties:\n *       'url': (string) The image url.\n *       'height': (number) The image height.\n *       'width': (number) The image width.\n *       'anchor': (Array) The anchor position of the label text.\n *       'textColor': (string) The text color.\n *       'textSize': (number) The text size.\n *       'backgroundPosition': (string) The position of the backgound x, y.\n * @constructor\n * @extends google.maps.OverlayView\n */\nfunction MarkerClusterer(map, opt_markers, opt_options) {\n  // MarkerClusterer implements google.maps.OverlayView interface. We use the\n  // extend function to extend MarkerClusterer with google.maps.OverlayView\n  // because it might not always be available when the code is defined so we\n  // look for it at the last possible moment. If it doesn't exist now then\n  // there is no point going ahead :)\n  this.extend(MarkerClusterer, google.maps.OverlayView);\n  this.map_ = map;\n\n  /**\n   * @type {Array.<google.maps.Marker>}\n   * @private\n   */\n  this.markers_ = [];\n\n  /**\n   *  @type {Array.<Cluster>}\n   */\n  this.clusters_ = [];\n\n  this.sizes = [53, 56, 66, 78, 90];\n\n  /**\n   * @private\n   */\n  this.styles_ = [];\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.ready_ = false;\n\n  var options = opt_options || {};\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.gridSize_ = options['gridSize'] || 60;\n\n  /**\n   * @private\n   */\n  this.minClusterSize_ = options['minimumClusterSize'] || 2;\n\n\n  /**\n   * @type {?number}\n   * @private\n   */\n  this.maxZoom_ = options['maxZoom'] || null;\n\n  this.styles_ = options['styles'] || [];\n\n  /**\n   * @type {string}\n   * @private\n   */\n  this.imagePath_ = options['imagePath'] ||\n      this.MARKER_CLUSTER_IMAGE_PATH_;\n\n  /**\n   * @type {string}\n   * @private\n   */\n  this.imageExtension_ = options['imageExtension'] ||\n      this.MARKER_CLUSTER_IMAGE_EXTENSION_;\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.zoomOnClick_ = true;\n\n  if (options['zoomOnClick'] != undefined) {\n    this.zoomOnClick_ = options['zoomOnClick'];\n  }\n\n  /**\n   * @type {boolean}\n   * @private\n   */\n  this.averageCenter_ = false;\n\n  if (options['averageCenter'] != undefined) {\n    this.averageCenter_ = options['averageCenter'];\n  }\n\n  this.setupStyles_();\n\n  this.setMap(map);\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.prevZoom_ = this.map_.getZoom();\n\n  // Add the map event listeners\n  var that = this;\n  google.maps.event.addListener(this.map_, 'zoom_changed', function() {\n    var zoom = that.map_.getZoom();\n\n    if (that.prevZoom_ != zoom) {\n      that.prevZoom_ = zoom;\n      that.resetViewport();\n    }\n  });\n\n  google.maps.event.addListener(this.map_, 'idle', function() {\n    that.redraw();\n  });\n\n  // Finally, add the markers\n  if (opt_markers && opt_markers.length) {\n    this.addMarkers(opt_markers, false);\n  }\n}\n\n\n/**\n * The marker cluster image path.\n *\n * @type {string}\n * @private\n */\nMarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_PATH_ =\n    'http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/' +\n    'images/m';\n\n\n/**\n * The marker cluster image path.\n *\n * @type {string}\n * @private\n */\nMarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_EXTENSION_ = 'png';\n\n\n/**\n * Extends a objects prototype by anothers.\n *\n * @param {Object} obj1 The object to be extended.\n * @param {Object} obj2 The object to extend with.\n * @return {Object} The new extended object.\n * @ignore\n */\nMarkerClusterer.prototype.extend = function(obj1, obj2) {\n  return (function(object) {\n    for (var property in object.prototype) {\n      this.prototype[property] = object.prototype[property];\n    }\n    return this;\n  }).apply(obj1, [obj2]);\n};\n\n\n/**\n * Implementaion of the interface method.\n * @ignore\n */\nMarkerClusterer.prototype.onAdd = function() {\n  this.setReady_(true);\n};\n\n/**\n * Implementaion of the interface method.\n * @ignore\n */\nMarkerClusterer.prototype.draw = function() {};\n\n/**\n * Sets up the styles object.\n *\n * @private\n */\nMarkerClusterer.prototype.setupStyles_ = function() {\n  if (this.styles_.length) {\n    return;\n  }\n\n  for (var i = 0, size; size = this.sizes[i]; i++) {\n    this.styles_.push({\n      url: this.imagePath_ + (i + 1) + '.' + this.imageExtension_,\n      height: size,\n      width: size\n    });\n  }\n};\n\n/**\n *  Fit the map to the bounds of the markers in the clusterer.\n */\nMarkerClusterer.prototype.fitMapToMarkers = function() {\n  var markers = this.getMarkers();\n  var bounds = new google.maps.LatLngBounds();\n  for (var i = 0, marker; marker = markers[i]; i++) {\n    bounds.extend(marker.getPosition());\n  }\n\n  this.map_.fitBounds(bounds);\n};\n\n\n/**\n *  Sets the styles.\n *\n *  @param {Object} styles The style to set.\n */\nMarkerClusterer.prototype.setStyles = function(styles) {\n  this.styles_ = styles;\n};\n\n\n/**\n *  Gets the styles.\n *\n *  @return {Object} The styles object.\n */\nMarkerClusterer.prototype.getStyles = function() {\n  return this.styles_;\n};\n\n\n/**\n * Whether zoom on click is set.\n *\n * @return {boolean} True if zoomOnClick_ is set.\n */\nMarkerClusterer.prototype.isZoomOnClick = function() {\n  return this.zoomOnClick_;\n};\n\n/**\n * Whether average center is set.\n *\n * @return {boolean} True if averageCenter_ is set.\n */\nMarkerClusterer.prototype.isAverageCenter = function() {\n  return this.averageCenter_;\n};\n\n\n/**\n *  Returns the array of markers in the clusterer.\n *\n *  @return {Array.<google.maps.Marker>} The markers.\n */\nMarkerClusterer.prototype.getMarkers = function() {\n  return this.markers_;\n};\n\n\n/**\n *  Returns the number of markers in the clusterer\n *\n *  @return {Number} The number of markers.\n */\nMarkerClusterer.prototype.getTotalMarkers = function() {\n  return this.markers_.length;\n};\n\n\n/**\n *  Sets the max zoom for the clusterer.\n *\n *  @param {number} maxZoom The max zoom level.\n */\nMarkerClusterer.prototype.setMaxZoom = function(maxZoom) {\n  this.maxZoom_ = maxZoom;\n};\n\n\n/**\n *  Gets the max zoom for the clusterer.\n *\n *  @return {number} The max zoom level.\n */\nMarkerClusterer.prototype.getMaxZoom = function() {\n  return this.maxZoom_;\n};\n\n\n/**\n *  The function for calculating the cluster icon image.\n *\n *  @param {Array.<google.maps.Marker>} markers The markers in the clusterer.\n *  @param {number} numStyles The number of styles available.\n *  @return {Object} A object properties: 'text' (string) and 'index' (number).\n *  @private\n */\nMarkerClusterer.prototype.calculator_ = function(markers, numStyles) {\n  var index = 0;\n  var count = markers.length;\n  var dv = count;\n  while (dv !== 0) {\n    dv = parseInt(dv / 10, 10);\n    index++;\n  }\n\n  index = Math.min(index, numStyles);\n  return {\n    text: count,\n    index: index\n  };\n};\n\n\n/**\n * Set the calculator function.\n *\n * @param {function(Array, number)} calculator The function to set as the\n *     calculator. The function should return a object properties:\n *     'text' (string) and 'index' (number).\n *\n */\nMarkerClusterer.prototype.setCalculator = function(calculator) {\n  this.calculator_ = calculator;\n};\n\n\n/**\n * Get the calculator function.\n *\n * @return {function(Array, number)} the calculator function.\n */\nMarkerClusterer.prototype.getCalculator = function() {\n  return this.calculator_;\n};\n\n\n/**\n * Add an array of markers to the clusterer.\n *\n * @param {Array.<google.maps.Marker>} markers The markers to add.\n * @param {boolean=} opt_nodraw Whether to redraw the clusters.\n */\nMarkerClusterer.prototype.addMarkers = function(markers, opt_nodraw) {\n  for (var i = 0, marker; marker = markers[i]; i++) {\n    this.pushMarkerTo_(marker);\n  }\n  if (!opt_nodraw) {\n    this.redraw();\n  }\n};\n\n\n/**\n * Pushes a marker to the clusterer.\n *\n * @param {google.maps.Marker} marker The marker to add.\n * @private\n */\nMarkerClusterer.prototype.pushMarkerTo_ = function(marker) {\n  marker.isAdded = false;\n  if (marker['draggable']) {\n    // If the marker is draggable add a listener so we update the clusters on\n    // the drag end.\n    var that = this;\n    google.maps.event.addListener(marker, 'dragend', function() {\n      marker.isAdded = false;\n      that.repaint();\n    });\n  }\n  this.markers_.push(marker);\n};\n\n\n/**\n * Adds a marker to the clusterer and redraws if needed.\n *\n * @param {google.maps.Marker} marker The marker to add.\n * @param {boolean=} opt_nodraw Whether to redraw the clusters.\n */\nMarkerClusterer.prototype.addMarker = function(marker, opt_nodraw) {\n  this.pushMarkerTo_(marker);\n  if (!opt_nodraw) {\n    this.redraw();\n  }\n};\n\n\n/**\n * Removes a marker and returns true if removed, false if not\n *\n * @param {google.maps.Marker} marker The marker to remove\n * @return {boolean} Whether the marker was removed or not\n * @private\n */\nMarkerClusterer.prototype.removeMarker_ = function(marker) {\n  var index = -1;\n  if (this.markers_.indexOf) {\n    index = this.markers_.indexOf(marker);\n  } else {\n    for (var i = 0, m; m = this.markers_[i]; i++) {\n      if (m == marker) {\n        index = i;\n        break;\n      }\n    }\n  }\n\n  if (index == -1) {\n    // Marker is not in our list of markers.\n    return false;\n  }\n\n  marker.setMap(null);\n\n  this.markers_.splice(index, 1);\n\n  return true;\n};\n\n\n/**\n * Remove a marker from the cluster.\n *\n * @param {google.maps.Marker} marker The marker to remove.\n * @param {boolean=} opt_nodraw Optional boolean to force no redraw.\n * @return {boolean} True if the marker was removed.\n */\nMarkerClusterer.prototype.removeMarker = function(marker, opt_nodraw) {\n  var removed = this.removeMarker_(marker);\n\n  if (!opt_nodraw && removed) {\n    this.resetViewport();\n    this.redraw();\n    return true;\n  } else {\n   return false;\n  }\n};\n\n\n/**\n * Removes an array of markers from the cluster.\n *\n * @param {Array.<google.maps.Marker>} markers The markers to remove.\n * @param {boolean=} opt_nodraw Optional boolean to force no redraw.\n */\nMarkerClusterer.prototype.removeMarkers = function(markers, opt_nodraw) {\n  var removed = false;\n\n  for (var i = 0, marker; marker = markers[i]; i++) {\n    var r = this.removeMarker_(marker);\n    removed = removed || r;\n  }\n\n  if (!opt_nodraw && removed) {\n    this.resetViewport();\n    this.redraw();\n    return true;\n  }\n};\n\n\n/**\n * Sets the clusterer's ready state.\n *\n * @param {boolean} ready The state.\n * @private\n */\nMarkerClusterer.prototype.setReady_ = function(ready) {\n  if (!this.ready_) {\n    this.ready_ = ready;\n    this.createClusters_();\n  }\n};\n\n\n/**\n * Returns the number of clusters in the clusterer.\n *\n * @return {number} The number of clusters.\n */\nMarkerClusterer.prototype.getTotalClusters = function() {\n  return this.clusters_.length;\n};\n\n\n/**\n * Returns the google map that the clusterer is associated with.\n *\n * @return {google.maps.Map} The map.\n */\nMarkerClusterer.prototype.getMap = function() {\n  return this.map_;\n};\n\n\n/**\n * Sets the google map that the clusterer is associated with.\n *\n * @param {google.maps.Map} map The map.\n */\nMarkerClusterer.prototype.setMap = function(map) {\n  this.map_ = map;\n};\n\n\n/**\n * Returns the size of the grid.\n *\n * @return {number} The grid size.\n */\nMarkerClusterer.prototype.getGridSize = function() {\n  return this.gridSize_;\n};\n\n\n/**\n * Sets the size of the grid.\n *\n * @param {number} size The grid size.\n */\nMarkerClusterer.prototype.setGridSize = function(size) {\n  this.gridSize_ = size;\n};\n\n\n/**\n * Returns the min cluster size.\n *\n * @return {number} The grid size.\n */\nMarkerClusterer.prototype.getMinClusterSize = function() {\n  return this.minClusterSize_;\n};\n\n/**\n * Sets the min cluster size.\n *\n * @param {number} size The grid size.\n */\nMarkerClusterer.prototype.setMinClusterSize = function(size) {\n  this.minClusterSize_ = size;\n};\n\n\n/**\n * Extends a bounds object by the grid size.\n *\n * @param {google.maps.LatLngBounds} bounds The bounds to extend.\n * @return {google.maps.LatLngBounds} The extended bounds.\n */\nMarkerClusterer.prototype.getExtendedBounds = function(bounds) {\n  var projection = this.getProjection();\n\n  // Turn the bounds into latlng.\n  var tr = new google.maps.LatLng(bounds.getNorthEast().lat(),\n      bounds.getNorthEast().lng());\n  var bl = new google.maps.LatLng(bounds.getSouthWest().lat(),\n      bounds.getSouthWest().lng());\n\n  // Convert the points to pixels and the extend out by the grid size.\n  var trPix = projection.fromLatLngToDivPixel(tr);\n  trPix.x += this.gridSize_;\n  trPix.y -= this.gridSize_;\n\n  var blPix = projection.fromLatLngToDivPixel(bl);\n  blPix.x -= this.gridSize_;\n  blPix.y += this.gridSize_;\n\n  // Convert the pixel points back to LatLng\n  var ne = projection.fromDivPixelToLatLng(trPix);\n  var sw = projection.fromDivPixelToLatLng(blPix);\n\n  // Extend the bounds to contain the new bounds.\n  bounds.extend(ne);\n  bounds.extend(sw);\n\n  return bounds;\n};\n\n\n/**\n * Determins if a marker is contained in a bounds.\n *\n * @param {google.maps.Marker} marker The marker to check.\n * @param {google.maps.LatLngBounds} bounds The bounds to check against.\n * @return {boolean} True if the marker is in the bounds.\n * @private\n */\nMarkerClusterer.prototype.isMarkerInBounds_ = function(marker, bounds) {\n  return bounds.contains(marker.getPosition());\n};\n\n\n/**\n * Clears all clusters and markers from the clusterer.\n */\nMarkerClusterer.prototype.clearMarkers = function() {\n  this.resetViewport(true);\n\n  // Set the markers a empty array.\n  this.markers_ = [];\n};\n\n\n/**\n * Clears all existing clusters and recreates them.\n * @param {boolean} opt_hide To also hide the marker.\n */\nMarkerClusterer.prototype.resetViewport = function(opt_hide) {\n  // Remove all the clusters\n  for (var i = 0, cluster; cluster = this.clusters_[i]; i++) {\n    cluster.remove();\n  }\n\n  // Reset the markers to not be added and to be invisible.\n  for (var i = 0, marker; marker = this.markers_[i]; i++) {\n    marker.isAdded = false;\n    if (opt_hide) {\n      marker.setMap(null);\n    }\n  }\n\n  this.clusters_ = [];\n};\n\n/**\n *\n */\nMarkerClusterer.prototype.repaint = function() {\n  var oldClusters = this.clusters_.slice();\n  this.clusters_.length = 0;\n  this.resetViewport();\n  this.redraw();\n\n  // Remove the old clusters.\n  // Do it in a timeout so the other clusters have been drawn first.\n  window.setTimeout(function() {\n    for (var i = 0, cluster; cluster = oldClusters[i]; i++) {\n      cluster.remove();\n    }\n  }, 0);\n};\n\n\n/**\n * Redraws the clusters.\n */\nMarkerClusterer.prototype.redraw = function() {\n  this.createClusters_();\n};\n\n\n/**\n * Calculates the distance between two latlng locations in km.\n * @see http://www.movable-type.co.uk/scripts/latlong.html\n *\n * @param {google.maps.LatLng} p1 The first lat lng point.\n * @param {google.maps.LatLng} p2 The second lat lng point.\n * @return {number} The distance between the two points in km.\n * @private\n*/\nMarkerClusterer.prototype.distanceBetweenPoints_ = function(p1, p2) {\n  if (!p1 || !p2) {\n    return 0;\n  }\n\n  var R = 6371; // Radius of the Earth in km\n  var dLat = (p2.lat() - p1.lat()) * Math.PI / 180;\n  var dLon = (p2.lng() - p1.lng()) * Math.PI / 180;\n  var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n    Math.cos(p1.lat() * Math.PI / 180) * Math.cos(p2.lat() * Math.PI / 180) *\n    Math.sin(dLon / 2) * Math.sin(dLon / 2);\n  var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  var d = R * c;\n  return d;\n};\n\n\n/**\n * Add a marker to a cluster, or creates a new cluster.\n *\n * @param {google.maps.Marker} marker The marker to add.\n * @private\n */\nMarkerClusterer.prototype.addToClosestCluster_ = function(marker) {\n  var distance = 40000; // Some large number\n  var clusterToAddTo = null;\n  var pos = marker.getPosition();\n  for (var i = 0, cluster; cluster = this.clusters_[i]; i++) {\n    var center = cluster.getCenter();\n    if (center) {\n      var d = this.distanceBetweenPoints_(center, marker.getPosition());\n      if (d < distance) {\n        distance = d;\n        clusterToAddTo = cluster;\n      }\n    }\n  }\n\n  if (clusterToAddTo && clusterToAddTo.isMarkerInClusterBounds(marker)) {\n    clusterToAddTo.addMarker(marker);\n  } else {\n    var cluster = new Cluster(this);\n    cluster.addMarker(marker);\n    this.clusters_.push(cluster);\n  }\n};\n\n\n/**\n * Creates the clusters.\n *\n * @private\n */\nMarkerClusterer.prototype.createClusters_ = function() {\n  if (!this.ready_) {\n    return;\n  }\n\n  // Get our current map view bounds.\n  // Create a new bounds object so we don't affect the map.\n  var mapBounds = new google.maps.LatLngBounds(this.map_.getBounds().getSouthWest(),\n      this.map_.getBounds().getNorthEast());\n  var bounds = this.getExtendedBounds(mapBounds);\n\n  for (var i = 0, marker; marker = this.markers_[i]; i++) {\n    if (!marker.isAdded && this.isMarkerInBounds_(marker, bounds)) {\n      this.addToClosestCluster_(marker);\n    }\n  }\n};\n\n\n/**\n * A cluster that contains markers.\n *\n * @param {MarkerClusterer} markerClusterer The markerclusterer that this\n *     cluster is associated with.\n * @constructor\n * @ignore\n */\nfunction Cluster(markerClusterer) {\n  this.markerClusterer_ = markerClusterer;\n  this.map_ = markerClusterer.getMap();\n  this.gridSize_ = markerClusterer.getGridSize();\n  this.minClusterSize_ = markerClusterer.getMinClusterSize();\n  this.averageCenter_ = markerClusterer.isAverageCenter();\n  this.center_ = null;\n  this.markers_ = [];\n  this.bounds_ = null;\n  this.clusterIcon_ = new ClusterIcon(this, markerClusterer.getStyles(),\n      markerClusterer.getGridSize());\n}\n\n/**\n * Determins if a marker is already added to the cluster.\n *\n * @param {google.maps.Marker} marker The marker to check.\n * @return {boolean} True if the marker is already added.\n */\nCluster.prototype.isMarkerAlreadyAdded = function(marker) {\n  if (this.markers_.indexOf) {\n    return this.markers_.indexOf(marker) != -1;\n  } else {\n    for (var i = 0, m; m = this.markers_[i]; i++) {\n      if (m == marker) {\n        return true;\n      }\n    }\n  }\n  return false;\n};\n\n\n/**\n * Add a marker the cluster.\n *\n * @param {google.maps.Marker} marker The marker to add.\n * @return {boolean} True if the marker was added.\n */\nCluster.prototype.addMarker = function(marker) {\n  if (this.isMarkerAlreadyAdded(marker)) {\n    return false;\n  }\n\n  if (!this.center_) {\n    this.center_ = marker.getPosition();\n    this.calculateBounds_();\n  } else {\n    if (this.averageCenter_) {\n      var l = this.markers_.length + 1;\n      var lat = (this.center_.lat() * (l-1) + marker.getPosition().lat()) / l;\n      var lng = (this.center_.lng() * (l-1) + marker.getPosition().lng()) / l;\n      this.center_ = new google.maps.LatLng(lat, lng);\n      this.calculateBounds_();\n    }\n  }\n\n  marker.isAdded = true;\n  this.markers_.push(marker);\n\n  var len = this.markers_.length;\n  if (len < this.minClusterSize_ && marker.getMap() != this.map_) {\n    // Min cluster size not reached so show the marker.\n    marker.setMap(this.map_);\n  }\n\n  if (len == this.minClusterSize_) {\n    // Hide the markers that were showing.\n    for (var i = 0; i < len; i++) {\n      this.markers_[i].setMap(null);\n    }\n  }\n\n  if (len >= this.minClusterSize_) {\n    marker.setMap(null);\n  }\n\n  this.updateIcon();\n  return true;\n};\n\n\n/**\n * Returns the marker clusterer that the cluster is associated with.\n *\n * @return {MarkerClusterer} The associated marker clusterer.\n */\nCluster.prototype.getMarkerClusterer = function() {\n  return this.markerClusterer_;\n};\n\n\n/**\n * Returns the bounds of the cluster.\n *\n * @return {google.maps.LatLngBounds} the cluster bounds.\n */\nCluster.prototype.getBounds = function() {\n  var bounds = new google.maps.LatLngBounds(this.center_, this.center_);\n  var markers = this.getMarkers();\n  for (var i = 0, marker; marker = markers[i]; i++) {\n    bounds.extend(marker.getPosition());\n  }\n  return bounds;\n};\n\n\n/**\n * Removes the cluster\n */\nCluster.prototype.remove = function() {\n  this.clusterIcon_.remove();\n  this.markers_.length = 0;\n  delete this.markers_;\n};\n\n\n/**\n * Returns the center of the cluster.\n *\n * @return {number} The cluster center.\n */\nCluster.prototype.getSize = function() {\n  return this.markers_.length;\n};\n\n\n/**\n * Returns the center of the cluster.\n *\n * @return {Array.<google.maps.Marker>} The cluster center.\n */\nCluster.prototype.getMarkers = function() {\n  return this.markers_;\n};\n\n\n/**\n * Returns the center of the cluster.\n *\n * @return {google.maps.LatLng} The cluster center.\n */\nCluster.prototype.getCenter = function() {\n  return this.center_;\n};\n\n\n/**\n * Calculated the extended bounds of the cluster with the grid.\n *\n * @private\n */\nCluster.prototype.calculateBounds_ = function() {\n  var bounds = new google.maps.LatLngBounds(this.center_, this.center_);\n  this.bounds_ = this.markerClusterer_.getExtendedBounds(bounds);\n};\n\n\n/**\n * Determines if a marker lies in the clusters bounds.\n *\n * @param {google.maps.Marker} marker The marker to check.\n * @return {boolean} True if the marker lies in the bounds.\n */\nCluster.prototype.isMarkerInClusterBounds = function(marker) {\n  return this.bounds_.contains(marker.getPosition());\n};\n\n\n/**\n * Returns the map that the cluster is associated with.\n *\n * @return {google.maps.Map} The map.\n */\nCluster.prototype.getMap = function() {\n  return this.map_;\n};\n\n\n/**\n * Updates the cluster icon\n */\nCluster.prototype.updateIcon = function() {\n  var zoom = this.map_.getZoom();\n  var mz = this.markerClusterer_.getMaxZoom();\n\n  if (mz && zoom > mz) {\n    // The zoom is greater than our max zoom so show all the markers in cluster.\n    for (var i = 0, marker; marker = this.markers_[i]; i++) {\n      marker.setMap(this.map_);\n    }\n    return;\n  }\n\n  if (this.markers_.length < this.minClusterSize_) {\n    // Min cluster size not yet reached.\n    this.clusterIcon_.hide();\n    return;\n  }\n\n  var numStyles = this.markerClusterer_.getStyles().length;\n  var sums = this.markerClusterer_.getCalculator()(this.markers_, numStyles);\n  this.clusterIcon_.setCenter(this.center_);\n  this.clusterIcon_.setSums(sums);\n  this.clusterIcon_.show();\n};\n\n\n/**\n * A cluster icon\n *\n * @param {Cluster} cluster The cluster to be associated with.\n * @param {Object} styles An object that has style properties:\n *     'url': (string) The image url.\n *     'height': (number) The image height.\n *     'width': (number) The image width.\n *     'anchor': (Array) The anchor position of the label text.\n *     'textColor': (string) The text color.\n *     'textSize': (number) The text size.\n *     'backgroundPosition: (string) The background postition x, y.\n * @param {number=} opt_padding Optional padding to apply to the cluster icon.\n * @constructor\n * @extends google.maps.OverlayView\n * @ignore\n */\nfunction ClusterIcon(cluster, styles, opt_padding) {\n  cluster.getMarkerClusterer().extend(ClusterIcon, google.maps.OverlayView);\n\n  this.styles_ = styles;\n  this.padding_ = opt_padding || 0;\n  this.cluster_ = cluster;\n  this.center_ = null;\n  this.map_ = cluster.getMap();\n  this.div_ = null;\n  this.sums_ = null;\n  this.visible_ = false;\n\n  this.setMap(this.map_);\n}\n\n\n/**\n * Triggers the clusterclick event and zoom's if the option is set.\n */\nClusterIcon.prototype.triggerClusterClick = function() {\n  var markerClusterer = this.cluster_.getMarkerClusterer();\n\n  // Trigger the clusterclick event.\n  google.maps.event.trigger(markerClusterer, 'clusterclick', this.cluster_);\n\n  if (markerClusterer.isZoomOnClick()) {\n    // Zoom into the cluster.\n    this.map_.fitBounds(this.cluster_.getBounds());\n  }\n};\n\n\n/**\n * Adding the cluster icon to the dom.\n * @ignore\n */\nClusterIcon.prototype.onAdd = function() {\n  this.div_ = document.createElement('DIV');\n  if (this.visible_) {\n    var pos = this.getPosFromLatLng_(this.center_);\n    this.div_.style.cssText = this.createCss(pos);\n    this.div_.innerHTML = this.sums_.text;\n  }\n\n  var panes = this.getPanes();\n  panes.overlayMouseTarget.appendChild(this.div_);\n\n  var that = this;\n  google.maps.event.addDomListener(this.div_, 'click', function() {\n    that.triggerClusterClick();\n  });\n};\n\n\n/**\n * Returns the position to place the div dending on the latlng.\n *\n * @param {google.maps.LatLng} latlng The position in latlng.\n * @return {google.maps.Point} The position in pixels.\n * @private\n */\nClusterIcon.prototype.getPosFromLatLng_ = function(latlng) {\n  var pos = this.getProjection().fromLatLngToDivPixel(latlng);\n  pos.x -= parseInt(this.width_ / 2, 10);\n  pos.y -= parseInt(this.height_ / 2, 10);\n  return pos;\n};\n\n\n/**\n * Draw the icon.\n * @ignore\n */\nClusterIcon.prototype.draw = function() {\n  if (this.visible_) {\n    var pos = this.getPosFromLatLng_(this.center_);\n    this.div_.style.top = pos.y + 'px';\n    this.div_.style.left = pos.x + 'px';\n  }\n};\n\n\n/**\n * Hide the icon.\n */\nClusterIcon.prototype.hide = function() {\n  if (this.div_) {\n    this.div_.style.display = 'none';\n  }\n  this.visible_ = false;\n};\n\n\n/**\n * Position and show the icon.\n */\nClusterIcon.prototype.show = function() {\n  if (this.div_) {\n    var pos = this.getPosFromLatLng_(this.center_);\n    this.div_.style.cssText = this.createCss(pos);\n    this.div_.style.display = '';\n  }\n  this.visible_ = true;\n};\n\n\n/**\n * Remove the icon from the map\n */\nClusterIcon.prototype.remove = function() {\n  this.setMap(null);\n};\n\n\n/**\n * Implementation of the onRemove interface.\n * @ignore\n */\nClusterIcon.prototype.onRemove = function() {\n  if (this.div_ && this.div_.parentNode) {\n    this.hide();\n    this.div_.parentNode.removeChild(this.div_);\n    this.div_ = null;\n  }\n};\n\n\n/**\n * Set the sums of the icon.\n *\n * @param {Object} sums The sums containing:\n *   'text': (string) The text to display in the icon.\n *   'index': (number) The style index of the icon.\n */\nClusterIcon.prototype.setSums = function(sums) {\n  this.sums_ = sums;\n  this.text_ = sums.text;\n  this.index_ = sums.index;\n  if (this.div_) {\n    this.div_.innerHTML = sums.text;\n  }\n\n  this.useStyle();\n};\n\n\n/**\n * Sets the icon to the the styles.\n */\nClusterIcon.prototype.useStyle = function() {\n  var index = Math.max(0, this.sums_.index - 1);\n  index = Math.min(this.styles_.length - 1, index);\n  var style = this.styles_[index];\n  this.url_ = style['url'];\n  this.height_ = style['height'];\n  this.width_ = style['width'];\n  this.textColor_ = style['textColor'];\n  this.anchor_ = style['anchor'];\n  this.textSize_ = style['textSize'];\n  this.backgroundPosition_ = style['backgroundPosition'];\n};\n\n\n/**\n * Sets the center of the icon.\n *\n * @param {google.maps.LatLng} center The latlng to set as the center.\n */\nClusterIcon.prototype.setCenter = function(center) {\n  this.center_ = center;\n};\n\n\n/**\n * Create the css text based on the position of the icon.\n *\n * @param {google.maps.Point} pos The position.\n * @return {string} The css style text.\n */\nClusterIcon.prototype.createCss = function(pos) {\n  var style = [];\n  style.push('background-image:url(' + this.url_ + ');');\n  var backgroundPosition = this.backgroundPosition_ ? this.backgroundPosition_ : '0 0';\n  style.push('background-position:' + backgroundPosition + ';');\n\n  if (typeof this.anchor_ === 'object') {\n    if (typeof this.anchor_[0] === 'number' && this.anchor_[0] > 0 &&\n        this.anchor_[0] < this.height_) {\n      style.push('height:' + (this.height_ - this.anchor_[0]) +\n          'px; padding-top:' + this.anchor_[0] + 'px;');\n    } else {\n      style.push('height:' + this.height_ + 'px; line-height:' + this.height_ +\n          'px;');\n    }\n    if (typeof this.anchor_[1] === 'number' && this.anchor_[1] > 0 &&\n        this.anchor_[1] < this.width_) {\n      style.push('width:' + (this.width_ - this.anchor_[1]) +\n          'px; padding-left:' + this.anchor_[1] + 'px;');\n    } else {\n      style.push('width:' + this.width_ + 'px; text-align:center;');\n    }\n  } else {\n    style.push('height:' + this.height_ + 'px; line-height:' +\n        this.height_ + 'px; width:' + this.width_ + 'px; text-align:center;');\n  }\n\n  var txtColor = this.textColor_ ? this.textColor_ : 'black';\n  var txtSize = this.textSize_ ? this.textSize_ : 11;\n\n  style.push('cursor:pointer; top:' + pos.y + 'px; left:' +\n      pos.x + 'px; color:' + txtColor + '; position:absolute; font-size:' +\n      txtSize + 'px; font-family:Arial,sans-serif; font-weight:bold');\n  return style.join('');\n};\n\n\n// Export Symbols for Closure\n// If you are not going to compile with closure then you can remove the\n// code below.\nglobal['MarkerClusterer'] = MarkerClusterer;\nMarkerClusterer.prototype['addMarker'] = MarkerClusterer.prototype.addMarker;\nMarkerClusterer.prototype['addMarkers'] = MarkerClusterer.prototype.addMarkers;\nMarkerClusterer.prototype['clearMarkers'] =\n    MarkerClusterer.prototype.clearMarkers;\nMarkerClusterer.prototype['fitMapToMarkers'] =\n    MarkerClusterer.prototype.fitMapToMarkers;\nMarkerClusterer.prototype['getCalculator'] =\n    MarkerClusterer.prototype.getCalculator;\nMarkerClusterer.prototype['getGridSize'] =\n    MarkerClusterer.prototype.getGridSize;\nMarkerClusterer.prototype['getExtendedBounds'] =\n    MarkerClusterer.prototype.getExtendedBounds;\nMarkerClusterer.prototype['getMap'] = MarkerClusterer.prototype.getMap;\nMarkerClusterer.prototype['getMarkers'] = MarkerClusterer.prototype.getMarkers;\nMarkerClusterer.prototype['getMaxZoom'] = MarkerClusterer.prototype.getMaxZoom;\nMarkerClusterer.prototype['getStyles'] = MarkerClusterer.prototype.getStyles;\nMarkerClusterer.prototype['getTotalClusters'] =\n    MarkerClusterer.prototype.getTotalClusters;\nMarkerClusterer.prototype['getTotalMarkers'] =\n    MarkerClusterer.prototype.getTotalMarkers;\nMarkerClusterer.prototype['redraw'] = MarkerClusterer.prototype.redraw;\nMarkerClusterer.prototype['removeMarker'] =\n    MarkerClusterer.prototype.removeMarker;\nMarkerClusterer.prototype['removeMarkers'] =\n    MarkerClusterer.prototype.removeMarkers;\nMarkerClusterer.prototype['resetViewport'] =\n    MarkerClusterer.prototype.resetViewport;\nMarkerClusterer.prototype['repaint'] =\n    MarkerClusterer.prototype.repaint;\nMarkerClusterer.prototype['setCalculator'] =\n    MarkerClusterer.prototype.setCalculator;\nMarkerClusterer.prototype['setGridSize'] =\n    MarkerClusterer.prototype.setGridSize;\nMarkerClusterer.prototype['setMaxZoom'] =\n    MarkerClusterer.prototype.setMaxZoom;\nMarkerClusterer.prototype['onAdd'] = MarkerClusterer.prototype.onAdd;\nMarkerClusterer.prototype['draw'] = MarkerClusterer.prototype.draw;\n\nCluster.prototype['getCenter'] = Cluster.prototype.getCenter;\nCluster.prototype['getSize'] = Cluster.prototype.getSize;\nCluster.prototype['getMarkers'] = Cluster.prototype.getMarkers;\n\nClusterIcon.prototype['onAdd'] = ClusterIcon.prototype.onAdd;\nClusterIcon.prototype['draw'] = ClusterIcon.prototype.draw;\nClusterIcon.prototype['onRemove'] = ClusterIcon.prototype.onRemove;\n\n\nmodule.exports = MarkerClusterer;\n"]},"metadata":{},"sourceType":"script"}